<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#060810" />
  <title>NEXUS // Events</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Space+Mono:wght@400;700&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg0: #060810;
      --bg1: #0a0d18;
      --bg2: #0d1120;
      --bg3: #111827;
      --card: rgba(13,17,32,0.82);
      --card2: rgba(10,13,24,0.92);
      --surface: rgba(255,255,255,0.04);
      --surface2: rgba(255,255,255,0.07);
      --border: rgba(255,255,255,0.08);
      --border2: rgba(255,255,255,0.14);
      --text: #e2e8f4;
      --muted: #7b8ba8;
      --muted2: #a0aec0;
      --accent: #3b82f6;
      --accent2: #06b6d4;
      --accent3: #8b5cf6;
      --ok: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --live: #22c55e;
      --gold: #fbbf24;
      --r: 16px;
      --r2: 12px;
      --r3: 8px;
      --shadow: 0 24px 64px rgba(0,0,0,0.6);
      --shadow2: 0 8px 32px rgba(0,0,0,0.4);
      --glow-accent: 0 0 24px rgba(59,130,246,0.25);
      --glow-live: 0 0 20px rgba(34,197,94,0.3);
      --glow-gold: 0 0 20px rgba(251,191,36,0.25);
      --logo-size: clamp(72px,9vw,108px);
      --font-display: 'Rajdhani', sans-serif;
      --font-mono: 'Space Mono', monospace;
      --font-body: 'DM Sans', sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: var(--font-body);
      color: var(--text);
      background: var(--bg0);
      background-image:
        radial-gradient(ellipse 1400px 600px at 5% 0%, rgba(59,130,246,0.08) 0%, transparent 60%),
        radial-gradient(ellipse 800px 600px at 95% 10%, rgba(6,182,212,0.07) 0%, transparent 55%),
        radial-gradient(ellipse 600px 400px at 50% 100%, rgba(139,92,246,0.06) 0%, transparent 50%);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Grid background texture */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(59,130,246,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59,130,246,0.03) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events: none;
      z-index: 0;
    }

    .wrap {
      position: relative;
      z-index: 1;
      max-width: 1040px;
      margin: 0 auto;
      padding: 0 18px 80px;
    }

    /* ‚îÄ‚îÄ‚îÄ NAV BAR ‚îÄ‚îÄ‚îÄ */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 16px 0 0;
      margin-bottom: 32px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 16px;
    }
    .topbar-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .brand {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: var(--text);
      text-decoration: none;
      text-transform: uppercase;
    }
    .brand span { color: var(--accent); }
    .sep {
      width: 1px;
      height: 24px;
      background: var(--border2);
    }
    .breadcrumb {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 0.05em;
    }
    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      padding: 8px 14px;
      border-radius: var(--r3);
      border: 1px solid var(--border2);
      background: var(--surface);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      outline: none;
      text-decoration: none;
      transition: all 0.18s ease;
      white-space: nowrap;
      user-select: none;
    }
    .btn:hover {
      background: var(--surface2);
      border-color: rgba(255,255,255,0.22);
      transform: translateY(-1px);
    }
    .btn:active { transform: translateY(0); }
    .btn:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }
    .btn.primary {
      background: rgba(59,130,246,0.18);
      border-color: rgba(59,130,246,0.35);
      color: #93c5fd;
    }
    .btn.primary:hover { background: rgba(59,130,246,0.28); }
    .btn.success {
      background: rgba(16,185,129,0.15);
      border-color: rgba(16,185,129,0.35);
      color: #6ee7b7;
    }
    .btn.success:hover { background: rgba(16,185,129,0.25); }
    .btn.danger {
      background: rgba(239,68,68,0.12);
      border-color: rgba(239,68,68,0.30);
      color: #fca5a5;
    }
    .btn.danger:hover { background: rgba(239,68,68,0.22); }
    .btn.warn {
      background: rgba(245,158,11,0.12);
      border-color: rgba(245,158,11,0.30);
      color: #fcd34d;
    }
    .btn.warn:hover { background: rgba(245,158,11,0.22); }
    .btn.ghost { background: transparent; border-color: transparent; }
    .btn.ghost:hover { background: var(--surface); border-color: var(--border); }
    .btn-icon { padding: 8px 10px; }
    .btn.active-on {
      background: rgba(59,130,246,0.2);
      border-color: rgba(59,130,246,0.45);
      color: #93c5fd;
    }

    /* ‚îÄ‚îÄ‚îÄ HEADER SECTION ‚îÄ‚îÄ‚îÄ */
    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }
    .page-title-group {}
    .page-eyebrow {
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.15em;
      color: var(--accent);
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .page-title {
      font-family: var(--font-display);
      font-size: clamp(32px,5vw,52px);
      font-weight: 700;
      letter-spacing: -0.01em;
      line-height: 1;
      text-transform: uppercase;
    }
    .page-title span { color: var(--accent); }
    .page-sub {
      margin-top: 8px;
      font-size: 14px;
      color: var(--muted2);
      max-width: 56ch;
      line-height: 1.6;
    }
    .page-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      padding-top: 4px;
    }

    /* ‚îÄ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ‚îÄ */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    @media (max-width: 640px) { .stats-bar { grid-template-columns: repeat(2,1fr); } }
    .stat-card {
      border: 1px solid var(--border);
      border-radius: var(--r2);
      background: var(--card);
      padding: 12px 14px;
      backdrop-filter: blur(12px);
    }
    .stat-label {
      font-family: var(--font-mono);
      font-size: 9px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .stat-value {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      line-height: 1;
      letter-spacing: -0.01em;
    }
    .stat-value.blue { color: #60a5fa; }
    .stat-value.green { color: #34d399; }
    .stat-value.gold { color: #fbbf24; }
    .stat-value.purple { color: #a78bfa; }

    /* ‚îÄ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ‚îÄ */
    .panel {
      border: 1px solid var(--border);
      border-radius: var(--r);
      background: var(--card);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow2);
      overflow: hidden;
      margin-bottom: 20px;
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
    }
    .panel-title {
      font-family: var(--font-display);
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .panel-hint {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.04em;
    }
    .panel-body { padding: 18px; }

    /* ‚îÄ‚îÄ‚îÄ FORM GRID ‚îÄ‚îÄ‚îÄ */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 14px;
    }
    @media (max-width: 680px) { .form-grid { grid-template-columns: 1fr; } }
    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-group.span2 { grid-column: span 2; }
    @media (max-width: 680px) { .form-group.span2 { grid-column: span 1; } }
    label {
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted2);
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px 13px;
      border-radius: var(--r3);
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border2);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: rgba(59,130,246,0.5);
      box-shadow: 0 0 0 3px rgba(59,130,246,0.12);
    }
    select option { background: var(--bg2); }
    input[type="file"] { padding: 8px 12px; font-size: 13px; color: var(--muted2); }
    input[type="number"] { -moz-appearance: textfield; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

    .form-hint {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.5;
      margin-top: 2px;
    }

    /* Location row */
    .location-row { display: flex; gap: 10px; align-items: center; }
    .flag-uploader {
      width: 42px; height: 42px;
      flex: 0 0 42px;
      border-radius: var(--r3);
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.25);
      display: grid;
      place-items: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .flag-uploader:hover { border-color: rgba(59,130,246,0.4); box-shadow: var(--glow-accent); }
    .flag-uploader img { width: 100%; height: 100%; object-fit: contain; display: block; }
    .flag-uploader .flag-emoji { font-size: 18px; }
    .flag-uploader .flag-badge {
      position: absolute;
      bottom: 2px; right: 2px;
      font-size: 7px;
      padding: 1px 4px;
      border-radius: 4px;
      background: rgba(0,0,0,0.55);
      color: rgba(229,231,235,0.8);
      pointer-events: none;
      letter-spacing: 0.03em;
    }

    /* Upload file inputs */
    .upload-pair { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 480px) { .upload-pair { grid-template-columns: 1fr; } }
    .upload-box {
      border: 1px dashed var(--border2);
      border-radius: var(--r3);
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
      background: rgba(0,0,0,0.15);
      position: relative;
    }
    .upload-box:hover { border-color: rgba(59,130,246,0.4); background: rgba(59,130,246,0.05); }
    .upload-box input[type="file"] {
      position: absolute; inset: 0;
      opacity: 0; cursor: pointer;
      width: 100%; height: 100%;
    }
    .upload-box-icon { font-size: 20px; margin-bottom: 4px; }
    .upload-box-label { font-size: 11px; color: var(--muted2); font-family: var(--font-mono); letter-spacing: 0.05em; }
    .upload-preview {
      width: 100%; max-height: 60px;
      object-fit: contain;
      border-radius: 6px;
      display: none;
    }

    /* Match inputs */
    .match-inputs { display: flex; flex-direction: column; gap: 8px; }

    /* Form actions */
    .form-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .form-feedback {
      font-size: 12px;
      line-height: 1.5;
      margin-left: auto;
      padding: 6px 10px;
      border-radius: var(--r3);
    }
    .form-feedback.error { color: #fca5a5; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); }
    .form-feedback.ok { color: #6ee7b7; background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.2); }
    .form-feedback.info { color: #93c5fd; background: rgba(59,130,246,0.08); border: 1px solid rgba(59,130,246,0.15); }

    /* ‚îÄ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ‚îÄ */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .filter-group {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r3);
      padding: 4px;
    }
    .filter-btn {
      padding: 5px 12px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: var(--muted2);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }
    .filter-btn:hover { color: var(--text); background: var(--surface); }
    .filter-btn.active { background: var(--surface2); color: var(--text); }
    .search-box {
      flex: 1;
      min-width: 160px;
      max-width: 280px;
      padding: 7px 12px;
      border-radius: var(--r3);
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-size: 13px;
      outline: none;
    }
    .search-box:focus { border-color: rgba(59,130,246,0.4); }
    .sort-select {
      padding: 7px 12px;
      border-radius: var(--r3);
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--muted2);
      font-size: 12px;
      outline: none;
      cursor: pointer;
    }

    /* ‚îÄ‚îÄ‚îÄ EVENT CARDS ‚îÄ‚îÄ‚îÄ */
    .events-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .event-card {
      position: relative;
      border: 1px solid var(--border);
      border-radius: var(--r);
      background: var(--card);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow2);
      overflow: hidden;
      transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .event-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.14);
      box-shadow: var(--shadow);
    }
    .event-card.is-live {
      border-color: rgba(34,197,94,0.22);
    }
    .event-card.is-live:hover {
      border-color: rgba(34,197,94,0.38);
      box-shadow: var(--shadow), var(--glow-live);
    }
    .event-card.is-major {
      border-color: rgba(251,191,36,0.18);
    }
    .event-card.is-major:hover {
      border-color: rgba(251,191,36,0.35);
      box-shadow: var(--shadow), var(--glow-gold);
    }

    /* Ambient background from logo */
    .event-card-bg {
      position: absolute;
      inset: 0;
      background-image: var(--event-bg, none);
      background-size: cover;
      background-position: center;
      opacity: 0.06;
      filter: blur(12px) saturate(1.5);
      pointer-events: none;
      z-index: 0;
      transition: opacity 0.3s;
    }
    .event-card:hover .event-card-bg { opacity: 0.1; }

    /* Accent line top */
    .event-card-accent {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent-color, rgba(59,130,246,0.7)), transparent);
      z-index: 1;
    }

    .event-card-inner {
      position: relative;
      z-index: 2;
      display: grid;
      grid-template-columns: var(--logo-size) 1fr;
      gap: 16px;
      padding: 18px;
      align-items: start;
    }
    @media (max-width: 600px) { .event-card-inner { grid-template-columns: 1fr; } }

    .event-logo-box {
      width: var(--logo-size);
      height: var(--logo-size);
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.2);
      display: grid;
      place-items: center;
      overflow: hidden;
      flex-shrink: 0;
    }
    .event-logo-box img {
      width: 100%; height: 100%;
      object-fit: contain;
      display: block;
    }
    .event-logo-placeholder { font-size: 28px; opacity: 0.7; }

    .event-content {}
    .event-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .event-name-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .event-name {
      font-family: var(--font-display);
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.01em;
      text-transform: uppercase;
      color: var(--text);
      text-decoration: none;
      transition: color 0.15s;
    }
    .event-name:hover { color: #93c5fd; }

    /* Pills */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border: 1px solid var(--border2);
      background: var(--surface);
      color: var(--muted2);
      white-space: nowrap;
    }
    .pill.live {
      border-color: rgba(34,197,94,0.3);
      background: rgba(34,197,94,0.1);
      color: #86efac;
    }
    .pill.live::before {
      content: "";
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--live);
      box-shadow: 0 0 8px var(--live);
      animation: pulse-dot 1.5s ease-in-out infinite;
    }
    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    .pill.finished { border-color: rgba(96,165,250,0.2); color: #93c5fd; background: rgba(59,130,246,0.07); }
    .pill.major {
      border-color: rgba(251,191,36,0.3);
      background: rgba(251,191,36,0.08);
      color: #fcd34d;
    }

    /* Stars */
    .stars-row { display: inline-flex; gap: 2px; align-items: center; }
    .star { font-size: 13px; color: rgba(255,255,255,0.18); }
    .star.on { color: var(--gold); filter: drop-shadow(0 0 4px rgba(251,191,36,0.5)); }

    /* Meta grid */
    .event-meta {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 8px;
      margin-bottom: 12px;
    }
    @media (max-width: 600px) { .event-meta { grid-template-columns: 1fr 1fr; } }
    .meta-kv {
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
      border-radius: var(--r3);
      padding: 9px 11px;
    }
    .meta-k {
      font-family: var(--font-mono);
      font-size: 9px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 3px;
    }
    .meta-v { font-size: 13px; color: var(--text); line-height: 1.3; }

    /* Flag mini */
    .flag-mini {
      width: 22px; height: 14px;
      border-radius: 3px;
      border: 1px solid var(--border2);
      object-fit: fill;
      vertical-align: -2px;
      margin-right: 5px;
      display: inline-block;
    }

    /* Live block */
    .live-block {
      border: 1px solid rgba(34,197,94,0.2);
      background: rgba(34,197,94,0.05);
      border-radius: var(--r3);
      padding: 12px;
      margin-bottom: 10px;
    }
    .live-block-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .live-block-title {
      font-family: var(--font-display);
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #86efac;
    }
    .match-list { display: flex; flex-direction: column; gap: 6px; }
    .match-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: var(--r3);
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
      font-size: 13px;
    }
    .match-row span:last-child { margin-left: auto; color: var(--muted2); font-size: 12px; }

    /* Finished block */
    .finished-block {
      border: 1px solid rgba(59,130,246,0.18);
      background: rgba(59,130,246,0.05);
      border-radius: var(--r3);
      padding: 12px;
      margin-bottom: 10px;
    }
    .winner-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .winner-label {
      font-family: var(--font-mono);
      font-size: 9px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .winner-name {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.01em;
      text-transform: uppercase;
      color: var(--gold);
    }
    .trophy-img {
      width: 24px; height: 24px;
      border-radius: 6px;
      border: 1px solid var(--border2);
      object-fit: contain;
    }
    .runner-up-row {
      font-size: 12px;
      color: var(--muted2);
      margin-bottom: 10px;
    }
    .runner-up-row strong { color: var(--text); }
    .highlights-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 7px;
    }
    @media (max-width: 500px) { .highlights-grid { grid-template-columns: 1fr 1fr; } }
    .highlight-chip {
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      border-radius: var(--r3);
      padding: 7px 9px;
      font-size: 12px;
      color: var(--muted2);
    }
    .highlight-chip strong { color: var(--text); display: block; font-size: 10px; font-family: var(--font-mono); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 2px; }

    /* Edit bar */
    .edit-bar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
    }

    /* ‚îÄ‚îÄ‚îÄ ANALYSIS MODAL ‚îÄ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      z-index: 100;
      display: grid;
      place-items: center;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      width: 100%;
      max-width: 640px;
      border: 1px solid var(--border2);
      border-radius: var(--r);
      background: var(--bg2);
      box-shadow: 0 40px 100px rgba(0,0,0,0.8);
      overflow: hidden;
      transform: translateY(20px);
      transition: transform 0.25s ease;
    }
    .modal-overlay.open .modal { transform: translateY(0); }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
    }
    .modal-title {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; }
    .analysis-section { margin-bottom: 16px; }
    .analysis-section-title {
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border);
    }
    .analysis-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--r3);
      border: 1px solid var(--border);
      background: var(--surface);
      margin-bottom: 6px;
      font-size: 13px;
      line-height: 1.5;
    }
    .analysis-item-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
    .analysis-bar-row {
      margin-bottom: 10px;
    }
    .analysis-bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted2);
      margin-bottom: 5px;
    }
    .analysis-bar-label strong { color: var(--text); }
    .analysis-bar-track {
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
    }
    .analysis-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 0.8s ease;
    }
    .analysis-highlight {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    .analysis-hl-card {
      border: 1px solid var(--border);
      border-radius: var(--r3);
      padding: 12px;
      background: var(--surface);
    }
    .analysis-hl-val {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 700;
      color: #60a5fa;
      line-height: 1;
    }
    .analysis-hl-desc { font-size: 11px; color: var(--muted); margin-top: 4px; }

    /* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      border: 1px dashed var(--border2);
      border-radius: var(--r);
    }
    .empty-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.5; }
    .empty-title {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--muted2);
      margin-bottom: 6px;
    }
    .empty-sub { font-size: 14px; color: var(--muted); }

    /* ‚îÄ‚îÄ‚îÄ BACK BUTTON ‚îÄ‚îÄ‚îÄ */
    .back-btn {
      position: fixed;
      left: 14px;
      bottom: 14px;
      z-index: 50;
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      font-family: var(--font-mono);
      font-size: 11px;
    }

    /* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
    .page-footer {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .footer-text {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.04em;
    }
    .footer-text span {
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.2);
      font-family: var(--font-mono);
    }
    .sync-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--muted);
    }
    .sync-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--muted);
      transition: background 0.3s, box-shadow 0.3s;
    }
    .sync-dot.ok { background: var(--ok); box-shadow: 0 0 8px rgba(16,185,129,0.5); }
    .sync-dot.saving { background: var(--warn); box-shadow: 0 0 8px rgba(245,158,11,0.5); animation: pulse-dot 1s infinite; }
    .sync-dot.err { background: var(--danger); }

    /* ‚îÄ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ‚îÄ */
    .hidden { display: none !important; }
    @media (max-width: 820px) {
      .topbar { flex-direction: column; gap: 8px; }
      .page-header { flex-direction: column; }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
  </style>
</head>

<body>

  <!-- Analysis Modal -->
  <div class="modal-overlay" id="analysisModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">üìä Intelligence Analysis</div>
        <button class="btn ghost btn-icon" id="closeAnalysis" title="Close">‚úï</button>
      </div>
      <div class="modal-body" id="analysisContent">
        <!-- Filled by JS -->
      </div>
    </div>
  </div>

  <!-- Back -->
  <a class="btn back-btn" href="index.html">‚Üê BACK <span style="opacity:0.5;font-size:10px;margin-left:2px;">[0]</span></a>

  <div class="wrap">

    <!-- TOP NAV -->
    <nav class="topbar">
      <div class="topbar-left">
        <a class="brand" href="index.html">NEXUS<span>//</span></a>
        <div class="sep"></div>
        <div class="breadcrumb">EVENTS MODULE</div>
      </div>
      <div class="topbar-right">
        <div class="sync-indicator">
          <div class="sync-dot" id="syncDot"></div>
          <span id="syncLabel">Local</span>
        </div>
        <button class="btn" id="exportBtn" title="Ctrl+Shift+S">‚¨á Export</button>
        <button class="btn" id="importBtnTop" title="Ctrl+Shift+O">‚¨Ü Import</button>
      </div>
    </nav>

    <!-- PAGE HEADER -->
    <div class="page-header">
      <div class="page-title-group">
        <div class="page-eyebrow">// Tournament Intelligence</div>
        <h1 class="page-title">Event <span>Registry</span></h1>
        <p class="page-sub">Track past and live tournaments. All data is synced to the cloud and persists permanently.</p>
      </div>
      <div class="page-actions">
        <button class="btn warn" id="analysisBtn">‚ö° Analyse</button>
        <button class="btn active-on" id="updateBtn">‚úé Update: OFF</button>
        <button class="btn primary" id="toggleAddBtn">Ôºã Add Event</button>
      </div>
    </div>

    <!-- STATS BAR -->
    <div class="stats-bar" id="statsBar">
      <div class="stat-card">
        <div class="stat-label">Total Events</div>
        <div class="stat-value blue" id="statTotal">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Live Now</div>
        <div class="stat-value green" id="statLive">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Majors</div>
        <div class="stat-value gold" id="statMajors">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Prize Pool (Total)</div>
        <div class="stat-value purple" id="statPrize">‚Äî</div>
      </div>
    </div>

    <!-- ADD / EDIT PANEL -->
    <section class="panel hidden" id="addPanel">
      <div class="panel-header">
        <div class="panel-title" id="panelTitle">Add New Event</div>
        <div class="panel-hint" id="panelHintTop">Fields marked with logos are optional</div>
      </div>
      <div class="panel-body">
        <!-- Logo uploads -->
        <div style="margin-bottom:14px;">
          <label style="margin-bottom:8px;">Logos (optional)</label>
          <div class="upload-pair">
            <div class="upload-box">
              <input type="file" id="eventLogo" accept="image/*" />
              <div class="upload-box-icon">üéØ</div>
              <div class="upload-box-label">Event Logo</div>
              <img class="upload-preview" id="eventLogoPreview" />
            </div>
            <div class="upload-box">
              <input type="file" id="trophyLogo" accept="image/*" />
              <div class="upload-box-icon">üèÜ</div>
              <div class="upload-box-label">Trophy Logo</div>
              <img class="upload-preview" id="trophyLogoPreview" />
            </div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Event Name *</label>
            <input id="name" placeholder="e.g. IEM Katowice 2026" />
          </div>
          <div class="form-group">
            <label>Google Drive Link *</label>
            <input id="link" placeholder="https://drive.google.com/..." />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="status">
              <option value="Finished">Finished</option>
              <option value="Live">Live</option>
            </select>
          </div>
          <div class="form-group">
            <label>Time / Period</label>
            <input id="time" placeholder="Jan 2026 / 10‚Äì20 Jan 2026 / Live" />
          </div>
          <div class="form-group">
            <label>Prize Pool</label>
            <input id="prizePool" placeholder="$1,000,000" />
          </div>
          <div class="form-group">
            <label>Teams</label>
            <input id="teams" type="number" min="0" placeholder="16" />
          </div>
          <div class="form-group">
            <label>Location</label>
            <div class="location-row">
              <label class="flag-uploader" for="flagUpload" title="Upload flag">
                <span class="flag-emoji" id="flagEmoji">üè≥Ô∏è</span>
                <img id="flagPreview" alt="flag" style="display:none;width:100%;height:100%;object-fit:contain;" />
                <span class="flag-badge">flag</span>
              </label>
              <input id="location" placeholder="City, Country" style="flex:1;" />
            </div>
            <input id="flagUpload" type="file" accept="image/*" class="hidden" />
          </div>
          <div class="form-group">
            <label>Importance (1‚Äì5)</label>
            <input id="importance" type="number" min="1" max="5" placeholder="3" />
          </div>
          <div class="form-group">
            <label>Major?</label>
            <select id="major">
              <option value="false">No</option>
              <option value="true">Yes</option>
            </select>
          </div>

          <!-- Live only -->
          <div class="form-group hidden" id="liveOnlyA">
            <label>Stage (Live)</label>
            <input id="stage" placeholder="Playoffs ‚Äî Semifinals" />
          </div>
          <div class="form-group span2 hidden" id="liveOnlyB">
            <label>Next Matches (Live, max 3) ‚Äî format: Team A vs Team B ‚Äì Time</label>
            <div class="match-inputs">
              <input id="m1" placeholder="Natus Vincere vs FaZe ‚Äì Today 18:00" />
              <input id="m2" placeholder="Team Spirit vs G2 ‚Äì Today 21:00" />
              <input id="m3" placeholder="FURIA vs Cloud9 ‚Äì Tomorrow 15:00" />
            </div>
          </div>

          <!-- Finished only -->
          <div class="form-group hidden" id="finishedOnlyA">
            <label>Winner Team (Finished)</label>
            <input id="winnerTeam" placeholder="Winner team name" />
          </div>
          <div class="form-group hidden" id="finishedOnlyA2">
            <label>2nd Place Team (Finished)</label>
            <input id="runnerUpTeam" placeholder="Runner-up name" />
          </div>
          <div class="form-group hidden" id="finishedOnlyB">
            <label>MVP / EVP / VP (Finished)</label>
            <div class="match-inputs">
              <input id="mvp" placeholder="MVP player" />
              <input id="evp" placeholder="EVP player" />
              <input id="vp"  placeholder="VP player" />
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn success" id="submitBtn">Ôºã Add Event</button>
          <button class="btn hidden" id="cancelEditBtn">‚úï Cancel</button>
          <button class="btn ghost" id="clearAllBtn">Clear Form</button>
          <div class="form-feedback hidden" id="formFeedback"></div>
        </div>
      </div>
    </section>

    <!-- FILTER BAR -->
    <div class="filter-bar" id="filterBar">
      <div class="filter-group">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="Live">Live</button>
        <button class="filter-btn" data-filter="Finished">Finished</button>
        <button class="filter-btn" data-filter="major">Majors</button>
      </div>
      <input class="search-box" id="searchBox" placeholder="Search events‚Ä¶" autocomplete="off" />
      <select class="sort-select" id="sortSelect">
        <option value="newest">Newest first</option>
        <option value="oldest">Oldest first</option>
        <option value="importance">By importance</option>
        <option value="az">A ‚Üí Z</option>
      </select>
    </div>

    <!-- EVENTS LIST -->
    <div class="events-list" id="eventsList"></div>

    <!-- FOOTER -->
    <div class="page-footer">
      <div class="footer-text">
        Cloud-synced via Firestore &nbsp;¬∑&nbsp; Local cache: <span>localStorage</span>
      </div>
      <div class="footer-text">
        <span>Ctrl+Shift+A</span> Add panel &nbsp; <span>Ctrl+Shift+S</span> Export &nbsp; <span>Ctrl+Shift+O</span> Import &nbsp; <span>0</span> Back
      </div>
    </div>
  </div>

  <!-- FIREBASE SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8iTRZRDX0UKmKavndwuqhyqsXareO0GI",
      authDomain: "teste-f32dc.firebaseapp.com",
      projectId: "teste-f32dc",
      storageBucket: "teste-f32dc.firebasestorage.app",
      messagingSenderId: "577371357875",
      appId: "1:577371357875:web:93ef689faf690c0d5fa6c6",
      measurementId: "G-LBM0XJGLRY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const NS = (location.pathname || "/").replace(/\/+$/, "") || "/";
    const DOC_ID = btoa(encodeURIComponent(NS));
    const DOC_REF = doc(db, "kzEvents", DOC_ID);

    async function loadEventsFromCloud() {
      const snap = await getDoc(DOC_REF);
      if (snap.exists()) {
        const data = snap.data();
        if (Array.isArray(data.events)) return data.events;
      }
      return null;
    }

    async function saveEventsToCloud(eventsArray) {
      await setDoc(DOC_REF, {
        events: eventsArray,
        updatedAt: Date.now(),
        namespace: NS,
        version: "v2"
      }, { merge: true });
    }

    function subscribeCloudUpdates(onUpdate) {
      return onSnapshot(DOC_REF, (snap) => {
        if (snap.exists()) {
          const data = snap.data();
          if (Array.isArray(data.events)) onUpdate(data.events);
        }
      });
    }

    window.__KZ_CLOUD__ = { auth, signInAnonymously, onAuthStateChanged, loadEventsFromCloud, saveEventsToCloud, subscribeCloudUpdates };
  </script>

  <!-- MAIN SCRIPT -->
  <script>
    const NS = (location.pathname || "/").replace(/\/+$/, "") || "/";
    const STORAGE_KEY = `kz_events_v2::${NS}`;

    function loadLocal() {
      try { const d = JSON.parse(localStorage.getItem(STORAGE_KEY)); return Array.isArray(d) ? d : []; }
      catch { return []; }
    }

    let events = loadLocal();
    let updateMode = false;
    let editingIndex = null;
    let filterStatus = "all";
    let searchQuery = "";
    let sortMode = "newest";
    let cloudReady = false;
    let cloudUnsub = null;

    // DOM refs
    const listEl = document.getElementById("eventsList");
    const addPanel = document.getElementById("addPanel");
    const toggleAddBtn = document.getElementById("toggleAddBtn");
    const updateBtn = document.getElementById("updateBtn");
    const submitBtn = document.getElementById("submitBtn");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const panelTitle = document.getElementById("panelTitle");
    const formFeedback = document.getElementById("formFeedback");
    const statusEl = document.getElementById("status");
    const syncDot = document.getElementById("syncDot");
    const syncLabel = document.getElementById("syncLabel");

    const g = id => document.getElementById(id);
    const inputs = {
      eventLogo: g("eventLogo"), trophyLogo: g("trophyLogo"),
      name: g("name"), link: g("link"), status: g("status"),
      time: g("time"), prizePool: g("prizePool"), teams: g("teams"),
      location: g("location"), importance: g("importance"), major: g("major"),
      stage: g("stage"), m1: g("m1"), m2: g("m2"), m3: g("m3"),
      winnerTeam: g("winnerTeam"), runnerUpTeam: g("runnerUpTeam"),
      mvp: g("mvp"), evp: g("evp"), vp: g("vp"),
    };

    // ‚îÄ‚îÄ SYNC UI ‚îÄ‚îÄ
    function setSyncState(state) {
      syncDot.className = "sync-dot " + state;
      syncLabel.textContent = state === "ok" ? "Synced" : state === "saving" ? "Saving‚Ä¶" : state === "err" ? "Offline" : "Local";
    }

    // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
    const st = v => (v ?? "").toString();

    function starsHTML(n) {
      const v = Math.max(0, Math.min(5, Number(n) || 0));
      return `<span class="stars-row">${Array.from({length:5},(_,i)=>`<span class="star ${i<v?"on":""}"">‚òÖ</span>`).join("")}</span>`;
    }

    function fileToDataURL(file) {
      return new Promise(resolve => {
        if (!file) return resolve("");
        const r = new FileReader();
        r.onload = () => resolve(r.result || "");
        r.onerror = () => resolve("");
        r.readAsDataURL(file);
      });
    }

    function isTyping(t) {
      if (!t) return false;
      const tag = (t.tagName || "").toLowerCase();
      return ["input","textarea","select"].includes(tag) || t.isContentEditable;
    }

    function toggleStatusFields() {
      const live = inputs.status.value === "Live";
      ["liveOnlyA","liveOnlyB"].forEach(id => g(id).classList.toggle("hidden", !live));
      ["finishedOnlyA","finishedOnlyA2","finishedOnlyB"].forEach(id => g(id).classList.toggle("hidden", live));
    }

    function showFeedback(msg, type = "") {
      formFeedback.textContent = msg || "";
      formFeedback.className = "form-feedback" + (type ? " " + type : "");
      formFeedback.classList.toggle("hidden", !msg);
    }

    function setFlagPreview(url) {
      const img = g("flagPreview");
      const emoji = g("flagEmoji");
      if (url) {
        img.src = url;
        img.style.display = "block";
        emoji.style.display = "none";
      } else {
        img.style.display = "none";
        img.removeAttribute("src");
        emoji.style.display = "";
      }
    }

    function setLogoPreview(inputEl, previewEl, url) {
      if (url) {
        previewEl.src = url;
        previewEl.style.display = "block";
      } else {
        previewEl.style.display = "none";
      }
    }

    // Logo previews on change
    g("eventLogo").addEventListener("change", async () => {
      const url = await fileToDataURL(g("eventLogo").files[0]);
      setLogoPreview(g("eventLogo"), g("eventLogoPreview"), url);
      // Update parent label appearance
      const box = g("eventLogo").closest(".upload-box");
      if (url) { box.querySelector(".upload-box-icon").style.display="none"; box.querySelector(".upload-box-label").style.display="none"; }
      else { box.querySelector(".upload-box-icon").style.display=""; box.querySelector(".upload-box-label").style.display=""; }
    });
    g("trophyLogo").addEventListener("change", async () => {
      const url = await fileToDataURL(g("trophyLogo").files[0]);
      setLogoPreview(g("trophyLogo"), g("trophyLogoPreview"), url);
    });
    g("flagUpload").addEventListener("change", async () => {
      const url = await fileToDataURL(g("flagUpload").files[0]);
      setFlagPreview(url);
    });

    // ‚îÄ‚îÄ CLEAR / ENTER MODES ‚îÄ‚îÄ
    function clearForm() {
      Object.values(inputs).forEach(el => { if (el.type === "file") el.value = ""; else if (el.tagName === "SELECT") {} else el.value = ""; });
      inputs.status.value = "Finished";
      inputs.major.value = "false";
      g("flagUpload").value = "";
      setFlagPreview("");
      g("eventLogoPreview").style.display = "none";
      g("trophyLogoPreview").style.display = "none";
      showFeedback("");
      toggleStatusFields();
    }

    function enterAddMode() {
      editingIndex = null;
      panelTitle.textContent = "Add New Event";
      submitBtn.textContent = "Ôºã Add Event";
      cancelEditBtn.classList.add("hidden");
      showFeedback("");
      clearForm();
    }

    function enterEditMode(idx) {
      const ev = events[idx];
      editingIndex = idx;
      panelTitle.textContent = "Update Event";
      submitBtn.textContent = "‚úì Save Update";
      cancelEditBtn.classList.remove("hidden");

      inputs.name.value = st(ev.name);
      inputs.link.value = st(ev.driveLink);
      inputs.status.value = st(ev.status || "Finished");
      inputs.time.value = st(ev.time);
      inputs.prizePool.value = st(ev.prizePool);
      inputs.teams.value = st(ev.teams);
      inputs.location.value = st(ev.location);
      inputs.importance.value = st(ev.importance);
      inputs.major.value = ev.major ? "true" : "false";
      inputs.stage.value = st(ev.stage);
      inputs.m1.value = st((ev.nextMatches||[])[0]||"");
      inputs.m2.value = st((ev.nextMatches||[])[1]||"");
      inputs.m3.value = st((ev.nextMatches||[])[2]||"");
      inputs.winnerTeam.value = st(ev.winnerTeam);
      inputs.runnerUpTeam.value = st(ev.runnerUpTeam);
      inputs.mvp.value = st(ev.mvp);
      inputs.evp.value = st(ev.evp);
      inputs.vp.value = st(ev.vp);

      setFlagPreview(ev.flagImage || "");
      toggleStatusFields();
      showFeedback("Upload new logo/flag only if you want to replace.", "info");

      addPanel.classList.remove("hidden");
      toggleAddBtn.classList.add("primary");
    }

    // ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ
    async function handleSubmit() {
      const name = inputs.name.value.trim();
      const link = inputs.link.value.trim();
      if (!name) return showFeedback("Event name is required.", "error");
      if (!link || !/^https?:\/\//i.test(link)) return showFeedback("A valid https link is required.", "error");

      const isLive = inputs.status.value === "Live";
      const newEventLogo = await fileToDataURL(inputs.eventLogo.files[0]);
      const newTrophyLogo = await fileToDataURL(inputs.trophyLogo.files[0]);
      const newFlagImage = await fileToDataURL(g("flagUpload").files[0]);
      const nextMatches = [inputs.m1.value.trim(),inputs.m2.value.trim(),inputs.m3.value.trim()].filter(Boolean).slice(0,3);

      const payload = {
        eventLogo: newEventLogo, trophyLogo: newTrophyLogo, flagImage: newFlagImage,
        name, driveLink: link, status: inputs.status.value,
        time: inputs.time.value.trim() || (isLive ? "Live" : ""),
        prizePool: inputs.prizePool.value.trim(),
        teams: Number(inputs.teams.value) || 0,
        location: inputs.location.value.trim(),
        importance: Math.max(1,Math.min(5,Number(inputs.importance.value)||1)),
        major: inputs.major.value === "true",
        stage: isLive ? inputs.stage.value.trim() : "",
        nextMatches: isLive ? nextMatches : [],
        winnerTeam: isLive ? "" : inputs.winnerTeam.value.trim(),
        runnerUpTeam: isLive ? "" : inputs.runnerUpTeam.value.trim(),
        mvp: isLive ? "" : inputs.mvp.value.trim(),
        evp: isLive ? "" : inputs.evp.value.trim(),
        vp:  isLive ? "" : inputs.vp.value.trim(),
        addedAt: editingIndex === null ? Date.now() : (events[editingIndex].addedAt || Date.now()),
      };

      if (editingIndex === null) {
        events.unshift(payload);
      } else {
        const old = events[editingIndex];
        payload.eventLogo = payload.eventLogo || old.eventLogo || "";
        payload.trophyLogo = payload.trophyLogo || old.trophyLogo || "";
        payload.flagImage = payload.flagImage || old.flagImage || "";
        events[editingIndex] = payload;
      }

      await saveEvents();
      updateStats();
      render();
      showFeedback(editingIndex === null ? "‚úì Event added and synced." : "‚úì Event updated and synced.", "ok");
      if (editingIndex === null) clearForm();
    }

    function deleteEvent(idx) {
      if (!confirm("Delete this event?")) return;
      events.splice(idx, 1);
      if (editingIndex === idx) enterAddMode();
      saveEvents().then(() => { updateStats(); render(); });
    }

    // ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ
    async function saveEvents() {
      setSyncState("saving");
      const raw = JSON.stringify(events);
      localStorage.setItem(STORAGE_KEY, raw);
      try {
        if (cloudReady && window.__KZ_CLOUD__) {
          await window.__KZ_CLOUD__.saveEventsToCloud(events);
          setSyncState("ok");
        } else {
          setSyncState("");
        }
      } catch(e) {
        console.warn("Cloud save failed:", e);
        setSyncState("err");
      }
    }

    // ‚îÄ‚îÄ STATS ‚îÄ‚îÄ
    function parsePrize(str) {
      if (!str) return 0;
      const n = parseFloat(str.replace(/[^0-9.]/g, ""));
      if (isNaN(n)) return 0;
      const s = str.toLowerCase();
      if (s.includes("m")) return n * 1000000;
      if (s.includes("k")) return n * 1000;
      return n;
    }

    function updateStats() {
      const total = events.length;
      const live = events.filter(e => e.status === "Live").length;
      const majors = events.filter(e => e.major).length;
      const totalPrize = events.reduce((acc, e) => acc + parsePrize(e.prizePool), 0);

      g("statTotal").textContent = total;
      g("statLive").textContent = live;
      g("statMajors").textContent = majors;

      if (totalPrize === 0) {
        g("statPrize").textContent = "‚Äî";
      } else if (totalPrize >= 1000000) {
        g("statPrize").textContent = "$" + (totalPrize / 1000000).toFixed(1) + "M";
      } else if (totalPrize >= 1000) {
        g("statPrize").textContent = "$" + (totalPrize / 1000).toFixed(0) + "K";
      } else {
        g("statPrize").textContent = "$" + totalPrize.toFixed(0);
      }
    }

    // ‚îÄ‚îÄ ANALYSIS ‚îÄ‚îÄ
    function openAnalysis() {
      if (events.length === 0) {
        alert("No events to analyze yet.");
        return;
      }

      const total = events.length;
      const live = events.filter(e => e.status === "Live").length;
      const finished = events.filter(e => e.status === "Finished").length;
      const majors = events.filter(e => e.major).length;
      const avgImportance = (events.reduce((a,e) => a + (Number(e.importance)||0), 0) / total).toFixed(1);
      const totalPrize = events.reduce((acc,e) => acc + parsePrize(e.prizePool), 0);
      const totalTeams = events.reduce((acc,e) => acc + (Number(e.teams)||0), 0);

      // Top winners
      const winnerCount = {};
      events.filter(e => e.winnerTeam).forEach(e => { winnerCount[e.winnerTeam] = (winnerCount[e.winnerTeam]||0) + 1; });
      const sortedWinners = Object.entries(winnerCount).sort((a,b)=>b[1]-a[1]).slice(0,5);

      // Top MVPs
      const mvpCount = {};
      events.filter(e => e.mvp).forEach(e => { mvpCount[e.mvp] = (mvpCount[e.mvp]||0) + 1; });
      const sortedMVPs = Object.entries(mvpCount).sort((a,b)=>b[1]-a[1]).slice(0,5);

      // Most common location
      const locCount = {};
      events.filter(e => e.location).forEach(e => {
        const loc = e.location.split(",").pop()?.trim() || e.location;
        locCount[loc] = (locCount[loc]||0) + 1;
      });
      const topLocation = Object.entries(locCount).sort((a,b)=>b[1]-a[1])[0];

      // Biggest prize
      const richest = events.filter(e => parsePrize(e.prizePool) > 0).sort((a,b)=>parsePrize(b.prizePool)-parsePrize(a.prizePool))[0];

      // Intelligence notes
      const notes = [];
      if (live > 0) notes.push({ icon: "üî¥", text: `${live} event${live>1?"s":""} currently live ‚Äî check for real-time updates.` });
      if (majors > 0) notes.push({ icon: "üëë", text: `${majors} Major${majors>1?"s":""} tracked. Majors represent ${((majors/total)*100).toFixed(0)}% of all events.` });
      if (avgImportance >= 4) notes.push({ icon: "‚≠ê", text: `Average importance of ${avgImportance}/5 ‚Äî your registry focuses on high-tier tournaments.` });
      else if (avgImportance <= 2) notes.push({ icon: "üìâ", text: `Average importance of ${avgImportance}/5 ‚Äî consider adding higher-tier events.` });
      else notes.push({ icon: "üìä", text: `Balanced importance average of ${avgImportance}/5 across all events.` });
      if (sortedWinners.length > 0 && sortedWinners[0][1] > 1) notes.push({ icon: "ü•á", text: `${sortedWinners[0][0]} is the most dominant team with ${sortedWinners[0][1]} wins tracked.` });
      if (totalPrize > 0) notes.push({ icon: "üí∞", text: `Total prize pool across finished events: $${(totalPrize/1000000).toFixed(2)}M.` });
      if (topLocation) notes.push({ icon: "üìç", text: `Most hosted region: ${topLocation[0]} (${topLocation[1]} event${topLocation[1]>1?"s":""}).` });
      if (richest) notes.push({ icon: "üéØ", text: `Richest event tracked: ${richest.name} with ${richest.prizePool} prize pool.` });

      const maxWins = sortedWinners.length > 0 ? sortedWinners[0][1] : 1;

      g("analysisContent").innerHTML = `
        <div class="analysis-section">
          <div class="analysis-section-title">üî¢ Overview</div>
          <div class="analysis-highlight">
            <div class="analysis-hl-card">
              <div class="analysis-hl-val">${total}</div>
              <div class="analysis-hl-desc">Total events tracked</div>
            </div>
            <div class="analysis-hl-card">
              <div class="analysis-hl-val" style="color:#34d399;">${live}</div>
              <div class="analysis-hl-desc">Currently live</div>
            </div>
            <div class="analysis-hl-card">
              <div class="analysis-hl-val" style="color:#fbbf24;">${majors}</div>
              <div class="analysis-hl-desc">Major events</div>
            </div>
            <div class="analysis-hl-card">
              <div class="analysis-hl-val" style="color:#a78bfa;">${totalTeams}</div>
              <div class="analysis-hl-desc">Teams participated (total)</div>
            </div>
          </div>
        </div>

        ${sortedWinners.length > 0 ? `
        <div class="analysis-section">
          <div class="analysis-section-title">üèÜ Top Winners</div>
          ${sortedWinners.map(([team, wins]) => `
            <div class="analysis-bar-row">
              <div class="analysis-bar-label">
                <strong>${team}</strong>
                <span>${wins} win${wins>1?"s":""}</span>
              </div>
              <div class="analysis-bar-track">
                <div class="analysis-bar-fill" style="width:${Math.round((wins/maxWins)*100)}%"></div>
              </div>
            </div>
          `).join("")}
        </div>` : ""}

        ${sortedMVPs.length > 0 ? `
        <div class="analysis-section">
          <div class="analysis-section-title">‚≠ê Top MVPs</div>
          ${sortedMVPs.map(([player, count]) => `
            <div class="analysis-item">
              <span class="analysis-item-icon">üéÆ</span>
              <span><strong>${player}</strong> ‚Äî MVP in ${count} event${count>1?"s":""}</span>
            </div>
          `).join("")}
        </div>` : ""}

        <div class="analysis-section">
          <div class="analysis-section-title">üß† Intelligence Notes</div>
          ${notes.map(n => `
            <div class="analysis-item">
              <span class="analysis-item-icon">${n.icon}</span>
              <span>${n.text}</span>
            </div>
          `).join("")}
        </div>
      `;

      g("analysisModal").classList.add("open");
    }

    // ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
    function getFilteredSorted() {
      let list = [...events];
      if (filterStatus !== "all") {
        if (filterStatus === "major") list = list.filter(e => e.major);
        else list = list.filter(e => e.status === filterStatus);
      }
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        list = list.filter(e =>
          (e.name||"").toLowerCase().includes(q) ||
          (e.location||"").toLowerCase().includes(q) ||
          (e.winnerTeam||"").toLowerCase().includes(q) ||
          (e.mvp||"").toLowerCase().includes(q)
        );
      }
      if (sortMode === "oldest") list.sort((a,b)=>(a.addedAt||0)-(b.addedAt||0));
      else if (sortMode === "importance") list.sort((a,b)=>(b.importance||0)-(a.importance||0));
      else if (sortMode === "az") list.sort((a,b)=>(a.name||"").localeCompare(b.name||""));
      else list.sort((a,b)=>(b.addedAt||0)-(a.addedAt||0));
      return list;
    }

    function render() {
      listEl.innerHTML = "";
      const list = getFilteredSorted();

      if (list.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <div class="empty-title">${events.length===0 ? "No Events Yet" : "No Results"}</div>
            <div class="empty-sub">${events.length===0 ? "Use the Add Event button to register your first tournament." : "Try adjusting your search or filters."}</div>
          </div>`;
        return;
      }

      // Map filtered items back to original indices
      const indexMap = new Map(events.map((ev,i)=>[ev,i]));

      list.forEach(ev => {
        const originalIdx = indexMap.get(ev);
        const isLive = ev.status === "Live";
        const accentColor = ev.major ? "rgba(251,191,36,0.7)" : isLive ? "rgba(34,197,94,0.7)" : "rgba(59,130,246,0.5)";

        const card = document.createElement("article");
        card.className = `event-card${isLive?" is-live":""}${ev.major?" is-major":""}`;

        const logoHTML = ev.eventLogo
          ? `<img src="${ev.eventLogo}" alt="${st(ev.name)}">`
          : `<div class="event-logo-placeholder">üìÖ</div>`;

        const timePill = isLive
          ? `<span class="pill live">Live</span>`
          : ev.time ? `<span class="pill finished">${st(ev.time)}</span>` : "";

        const majorPill = ev.major ? `<span class="pill major">üëë Major</span>` : "";

        let locHTML = "";
        const locText = st(ev.location) || "‚Äî";
        if (ev.flagImage) locHTML = `<img class="flag-mini" src="${ev.flagImage}" alt="flag">${locText}`;
        else locHTML = locText;

        const liveBlock = isLive ? `
          <div class="live-block">
            <div class="live-block-head">
              <div class="live-block-title">Live Details</div>
              <span class="pill live">Stage: ${st(ev.stage)||"‚Äî"}</span>
            </div>
            <div class="match-list">
              ${(ev.nextMatches||[]).slice(0,3).map(m=>`
                <div class="match-row">
                  <span>${st(m).split(" ‚Äì ")[0]||st(m)}</span>
                  <span>${st(m).includes(" ‚Äì ")?st(m).split(" ‚Äì ").slice(1).join(" ‚Äì "):""}</span>
                </div>`).join("")||`<div style="font-size:12px;color:var(--muted);padding:4px 0;">No matches scheduled yet.</div>`}
            </div>
          </div>` : "";

        const finishedBlock = !isLive ? `
          <div class="finished-block">
            <div class="winner-row">
              <span class="winner-label">Winner</span>
              <span class="winner-name">${st(ev.winnerTeam)||"‚Äî"}</span>
              ${ev.trophyLogo && ev.winnerTeam ? `<img class="trophy-img" src="${ev.trophyLogo}" alt="trophy">` : ""}
            </div>
            <div class="runner-up-row"><strong>2nd place:</strong> ${st(ev.runnerUpTeam)||"‚Äî"}</div>
            <div class="highlights-grid">
              <div class="highlight-chip"><strong>MVP</strong>${st(ev.mvp)||"‚Äî"}</div>
              <div class="highlight-chip"><strong>EVP</strong>${st(ev.evp)||"‚Äî"}</div>
              <div class="highlight-chip"><strong>VP</strong>${st(ev.vp)||"‚Äî"}</div>
            </div>
          </div>` : "";

        const editBar = updateMode ? `
          <div class="edit-bar">
            <button class="btn primary" data-action="edit" data-idx="${originalIdx}">‚úé Edit</button>
            <button class="btn danger" data-action="delete" data-idx="${originalIdx}">‚úï Delete</button>
          </div>` : "";

        card.innerHTML = `
          <div class="event-card-bg" style="background-image:url('${ev.eventLogo||""}')"></div>
          <div class="event-card-accent" style="--accent-color:${accentColor}"></div>
          <div class="event-card-inner">
            <div class="event-logo-box">${logoHTML}</div>
            <div class="event-content">
              <div class="event-head">
                <div class="event-name-row">
                  <a class="event-name" href="${st(ev.driveLink)}" target="_blank" rel="noopener">${st(ev.name)}</a>
                  ${timePill}${majorPill}
                </div>
                ${starsHTML(ev.importance)}
              </div>
              <div class="event-meta">
                <div class="meta-kv"><div class="meta-k">Prize Pool</div><div class="meta-v">${st(ev.prizePool)||"‚Äî"}</div></div>
                <div class="meta-kv"><div class="meta-k">Teams</div><div class="meta-v">${st(ev.teams)||"0"}</div></div>
                <div class="meta-kv"><div class="meta-k">Location</div><div class="meta-v">${locHTML}</div></div>
              </div>
              ${liveBlock}${finishedBlock}${editBar}
            </div>
          </div>`;

        listEl.appendChild(card);
      });

      listEl.querySelectorAll("button[data-action]").forEach(btn => {
        btn.addEventListener("click", () => {
          const action = btn.dataset.action;
          const idx = Number(btn.dataset.idx);
          if (action === "edit") enterEditMode(idx);
          else if (action === "delete") deleteEvent(idx);
        });
      });
    }

    // ‚îÄ‚îÄ FILTER / SEARCH / SORT ‚îÄ‚îÄ
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        filterStatus = btn.dataset.filter;
        render();
      });
    });

    g("searchBox").addEventListener("input", e => {
      searchQuery = e.target.value.trim();
      render();
    });

    g("sortSelect").addEventListener("change", e => {
      sortMode = e.target.value;
      render();
    });

    // ‚îÄ‚îÄ EXPORT / IMPORT ‚îÄ‚îÄ
    function exportEvents() {
      const blob = new Blob([JSON.stringify(events, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "kz-events-backup.json";
      a.click();
      URL.revokeObjectURL(a.href);
      showFeedback("‚úì Exported: kz-events-backup.json", "ok");
    }

    function importEvents(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!Array.isArray(data)) throw new Error();
          events = data;
          saveEvents().then(() => { updateStats(); render(); showFeedback("‚úì Backup imported and synced.", "ok"); });
        } catch { showFeedback("Import failed: invalid JSON.", "error"); }
      };
      reader.readAsText(file);
    }

    function openImport() {
      const inp = document.createElement("input");
      inp.type = "file"; inp.accept = "application/json";
      inp.onchange = () => { if (inp.files[0]) importEvents(inp.files[0]); };
      inp.click();
    }

    // ‚îÄ‚îÄ EVENTS ‚îÄ‚îÄ
    statusEl.addEventListener("change", toggleStatusFields);
    submitBtn.addEventListener("click", handleSubmit);
    cancelEditBtn.addEventListener("click", () => { enterAddMode(); });
    clearAllBtn.addEventListener("click", () => { clearForm(); });

    updateBtn.addEventListener("click", () => {
      updateMode = !updateMode;
      updateBtn.textContent = `‚úé Update: ${updateMode ? "ON" : "OFF"}`;
      updateBtn.classList.toggle("active-on", updateMode);
      if (!updateMode) enterAddMode();
      render();
    });

    toggleAddBtn.addEventListener("click", () => {
      addPanel.classList.toggle("hidden");
      toggleAddBtn.classList.toggle("primary", !addPanel.classList.contains("hidden"));
    });

    g("analysisBtn").addEventListener("click", openAnalysis);
    g("closeAnalysis").addEventListener("click", () => g("analysisModal").classList.remove("open"));
    g("analysisModal").addEventListener("click", e => { if (e.target === g("analysisModal")) g("analysisModal").classList.remove("open"); });

    g("exportBtn").addEventListener("click", exportEvents);
    g("importBtnTop").addEventListener("click", openImport);

    document.addEventListener("keydown", e => {
      if (e.ctrlKey && e.shiftKey && ["a","A"].includes(e.key)) { e.preventDefault(); toggleAddBtn.click(); }
      if (e.ctrlKey && e.shiftKey && ["s","S"].includes(e.key)) { e.preventDefault(); exportEvents(); }
      if (e.ctrlKey && e.shiftKey && ["o","O"].includes(e.key)) { e.preventDefault(); openImport(); }
      if (e.key === "Escape") g("analysisModal").classList.remove("open");
      if (e.key === "0" && !isTyping(e.target)) window.location.href = "index.html";
    });

    // ‚îÄ‚îÄ CLOUD BOOT ‚îÄ‚îÄ
    async function initCloud() {
      if (!window.__KZ_CLOUD__) return false;
      const { auth, signInAnonymously, onAuthStateChanged } = window.__KZ_CLOUD__;
      return new Promise(resolve => {
        onAuthStateChanged(auth, async user => {
          if (user) { cloudReady = true; resolve(true); }
          else { try { await signInAnonymously(auth); } catch { resolve(false); } }
        });
      });
    }

    async function boot() {
      events = loadLocal();
      toggleStatusFields();
      enterAddMode();
      updateStats();
      render();

      const ok = await initCloud();
      if (!ok) { setSyncState("err"); return; }

      try {
        const cloud = await window.__KZ_CLOUD__.loadEventsFromCloud();
        if (Array.isArray(cloud)) {
          events = cloud;
          localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
          updateStats();
          render();
        } else {
          await window.__KZ_CLOUD__.saveEventsToCloud(events);
        }

        if (cloudUnsub) cloudUnsub();
        cloudUnsub = window.__KZ_CLOUD__.subscribeCloudUpdates(cloudArr => {
          events = cloudArr;
          localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
          updateStats();
          render();
          setSyncState("ok");
        });

        setSyncState("ok");
      } catch(err) {
        console.warn("Cloud sync failed:", err);
        setSyncState("err");
      }
    }

    boot();
  </script>
</body>
</html>
